(function(){function e(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"about/about.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}angular.module("cargoApp",["ngRoute","ngSanitize","ui.bootstrap"]),angular.module("cargoApp").config(["$routeProvider","$locationProvider",e])})(),function(){function e(e,t,r,o){function n(e){function t(){a.setPage(1)}function r(e){1>e||e>a.pager.totalPages||(a.pager=o.GetPager(a.dummyItems.length,e,3),a.page={cargos:a.dummyItems.slice(a.pager.startIndex,a.pager.endIndex+1)})}a.dummyItems=e,a.pager={},a.setPage=r,t()}var a=this;a.message="",a.pageHeader={title:"Ачаа тээш бүртгэл",strapline:"Таньд хөдөө орон нутгаас ачаа тээш илгээсэн үү!"},a.isLoggedIn=r.isLoggedIn(),a.currentUser=r.currentUser(),a.isLoggedIn&&t.cargos().success(function(e){a.message=e.length>0?"":" Ачаа тээш олдсонгүй",a.data={cargos:e},n(e)}).error(function(e){a.message="Алдаа гарлаа"+e}),a.search=function(e){a.message="Хайж байна...",t.searchCargos(e).success(function(e){a.message=e.length>0?"":"Үр дүн олдсонгүй.",a.result={cargos:e}}).error(function(e){a.message="Алдаа гарлаа"+e})},a.popupAddForm=function(){var t=e.open({templateUrl:"/addModal/addModal.view.html",controller:"addModalCtrl as vm1"});t.result.then(function(e){a.data.cargos.push(e),n(a.data.cargos)})},a.popupDetailForm=function(t){e.open({templateUrl:"/detailModal/detailModal.view.html",controller:"detailModalCtrl as vm",resolve:{data:function(){return{cargoid:t}}}})},a.received=function(e,r){t.updateCargo(e,{value:!r}).success(function(){a.data.cargos.forEach(function(t){t._id===e&&(t.status=!r)})}).error(function(e){a.message=e})}}angular.module("cargoApp").controller("homeCtrl",e),"/"!==window.location.pathname&&(window.location.href="/#"+window.location.pathname),e.$inject=["$modal","cargoData","authentication","PagerService"]}(),function(){function e(){var e=this;e.pageHeader={title:"Сайтыг хэрэглэх заавар"}}angular.module("cargoApp").controller("aboutCtrl",e)}(),function(){function e(e,t,r){var o=this;t.cargoById(r.cargoid).success(function(e){o.data=e}),o.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}angular.module("cargoApp").controller("detailModalCtrl",e),e.$inject=["$modalInstance","cargoData","data"]}(),function(){function e(e,t){var r=this;r.formData={name:""},r.onSubmit=function(){r.formError="",t.addCargo({name:r.formData.name,number:r.formData.number,busNumber:r.formData.busNumber,from:r.formData.from,desc:r.formData.description}).success(function(e){r.modal.close(e)}).error(function(e){r.formError="Хадгалахад алдаа гарлаа. Алдаа: "+e})},t.buses().success(function(e){r.buses=e}).error(function(e){r.formError="Автобус татахад алдаа гарлаа."+e}),r.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}angular.module("cargoApp").controller("addModalCtrl",e),e.$inject=["$modalInstance","cargoData"]}(),function(){function e(e,t){var r=this;r.pageHeader={title:"Нэвтрэх"},r.credentials={username:"",password:""},r.returnPage=e.search().page||"/",r.onSubmit=function(){r.formError="",r.credentials.username&&r.credentials.password?r.doLogin():r.formError="Бүх талбаруудыг бөглөх ёстой!"},r.doLogin=function(){t.login(r.credentials).error(function(e){r.formError=e}).then(function(){e.search("page",null),e.path(r.returnPage)})}}angular.module("cargoApp").controller("loginCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(e,t,r){var o=this;o.pageHeader={title:"Шинээр бүртгүүлэх"},o.returnPage=e.search().page||"/",o.onSubmit=function(){o.formError="",r.addLocation(o.location).error(function(e){o.formError=11e3==e.code?"Уг тээш хадгалах газрын нэр бүртгэгдсэн байна.":"Тээш хадгалах газар бүртгэхэд алдаа гарлаа."}).then(function(n){var a=n.data._id;o.credentials.locationId=a,t.register(o.credentials).error(function(e){o.formError=11e3==e.code?"Уг хэрэглэгчийн нэр бүртгэгдсэн байна. ":"Хэрэглэгч бүртгэхэд алдаа гарлаа. ",r.deleteLocation(a).success(function(){}).error(function(){o.formError+="Үүссэн газрыг устгахад алдаа гарлаа."})}).then(function(){e.search("page",null),e.path(o.returnPage)})})}}angular.module("cargoApp").controller("registerCtrl",e),e.$inject=["$location","authentication","cargoData"]}(),function(){function e(e,t){var r=function(){return e.get("/api/cargo",{headers:{Authorization:"Bearer "+t.getToken()}})},o=function(t){return e.get("/api/cargo/"+t)},n=function(){return e.get("/api/bus")},a=function(r){return e.post("/api/newCargo/",r,{headers:{Authorization:"Bearer "+t.getToken()}})},c=function(r,o){return e.put("/api/updateCargo/"+r,o,{headers:{Authorization:"Bearer "+t.getToken()}})},i=function(t){return e.get("/api/searchCargos/"+t)},u=function(t){return e.post("/api/newLocation/",t)},l=function(t){return e.delete("/api/location/"+t)};return{cargos:r,cargoById:o,buses:n,addCargo:a,updateCargo:c,searchCargos:i,addLocation:u,deleteLocation:l}}angular.module("cargoApp").service("cargoData",e),e.$inject=["$http","authentication"]}(),function(){function e(e,t){var r=function(t){e.localStorage["loc8r-token"]=t},o=function(){return e.localStorage["loc8r-token"]},n=function(e){return t.post("api/login",e).success(function(e){r(e.token)})},a=function(e){return t.post("api/register",e).success(function(e){r(e.token)})},c=function(){e.localStorage.removeItem("loc8r-token")},i=function(){var t=o();if(t){var r=JSON.parse(e.atob(t.split(".")[1]));return r.exp>Date.now()/1e3}return!1},u=function(){if(i()){var t=o(),r=JSON.parse(e.atob(t.split(".")[1]));return{username:r.username,locationId:r.locationId}}};return{getToken:o,login:n,register:a,logout:c,isLoggedIn:i,currentUser:u}}angular.module("cargoApp").service("authentication",e),e.$inject=["$window","$http"]}(),function(){function e(){function e(e,t,r){t=t||1,r=r||10;var o,n,a=Math.ceil(e/r);10>=a?(o=1,n=a):6>=t?(o=1,n=10):t+4>=a?(o=a-9,n=a):(o=t-5,n=t+4);var c=(t-1)*r,u=Math.min(c+r-1,e-1),l=[],s=0;for(i=o;n>=i;i++)l[s]=i,s++;return{totalItems:e,currentPage:t,pageSize:r,totalPages:a,startPage:o,endPage:n,startIndex:c,endIndex:u,pages:l}}var t={};return t.GetPager=e,t}angular.module("cargoApp").service("PagerService",e)}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("cargoApp").directive("navigation",e)}(),function(){function e(e,t){nvm=this,nvm.currentPath=e.path(),nvm.isLoggedIn=t.isLoggedIn(),nvm.currentUser=t.currentUser(),nvm.logout=function(){t.logout(),e.path("/#")}}angular.module("cargoApp").controller("navigationCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}angular.module("cargoApp").directive("footerGeneric",e)}(),function(){function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}angular.module("cargoApp").directive("pageHeader",e)}();